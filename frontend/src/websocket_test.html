<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Chatbot - Text & Voice Chat</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #f3f4f6;
            color: #111827;
            height: 100vh;
            overflow: hidden;
        }

        .container {
            display: flex;
            height: 100vh;
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeIn 0.2s ease-out;
        }

        .modal {
            background: white;
            border-radius: 16px;
            padding: 32px;
            max-width: 480px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease-out;
        }

        .modal-header {
            text-align: center;
            margin-bottom: 24px;
        }

        .modal-header h2 {
            font-size: 24px;
            margin-bottom: 8px;
            color: #111827;
        }

        .modal-header p {
            color: #6b7280;
            font-size: 14px;
        }

        .chat-mode-options {
            display: grid;
            gap: 16px;
            margin-bottom: 24px;
        }

        .mode-option {
            padding: 20px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .mode-option:hover {
            border-color: #4f46e5;
            background-color: #f9fafb;
        }

        .mode-option.selected {
            border-color: #4f46e5;
            background-color: #e0e7ff;
        }

        .mode-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #f3f4f6;
        }

        .mode-option.selected .mode-icon {
            background-color: #4f46e5;
            color: white;
        }

        .mode-info h3 {
            font-size: 18px;
            margin-bottom: 4px;
            color: #111827;
        }

        .mode-info p {
            font-size: 14px;
            color: #6b7280;
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        .modal-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .modal-btn.cancel {
            background-color: #f3f4f6;
            color: #6b7280;
        }

        .modal-btn.cancel:hover {
            background-color: #e5e7eb;
        }

        .modal-btn.primary {
            background-color: #4f46e5;
            color: white;
        }

        .modal-btn.primary:hover {
            background-color: #4338ca;
        }

        .modal-btn.primary:disabled {
            background-color: #e5e7eb;
            color: #9ca3af;
            cursor: not-allowed;
        }

        /* Sidebar Styles */
        .sidebar {
            width: 280px;
            background-color: white;
            border-right: 1px solid #e5e7eb;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .sidebar-nav {
            padding: 8px;
            border-bottom: 1px solid #e5e7eb;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 12px;
            margin-bottom: 4px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
            color: #6b7280;
            font-size: 14px;
            font-weight: 500;
        }

        .nav-item:hover {
            background-color: #f3f4f6;
            color: #4f46e5;
        }

        .nav-item.active {
            background-color: #e0e7ff;
            color: #4f46e5;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid #e5e7eb;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #e0e7ff;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #4338ca;
            font-weight: 600;
        }

        .new-chat-btn {
            width: 100%;
            padding: 12px;
            background-color: #4f46e5;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: background-color 0.2s;
        }

        .new-chat-btn:hover {
            background-color: #4338ca;
        }

        .chat-list {
            flex: 1;
            overflow-y: auto;
            padding: 8px;
        }

        .chat-item {
            padding: 12px;
            margin-bottom: 4px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-item:hover {
            background-color: #f3f4f6;
        }

        .chat-item.active {
            background-color: #e0e7ff;
            color: #4338ca;
        }

        .chat-mode-badge {
            font-size: 10px;
            padding: 2px 8px;
            border-radius: 12px;
            background-color: #f3f4f6;
            color: #6b7280;
            font-weight: 500;
        }

        .chat-item.active .chat-mode-badge {
            background-color: #4f46e5;
            color: white;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            background-color: #f9fafb;
        }

        /* Chat Header */
        .chat-header {
            padding: 16px 24px;
            background-color: white;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: #6b7280;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #10b981;
        }

        /* Messages Area */
        .messages-area {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .message {
            max-width: 70%;
            padding: 16px;
            border-radius: 12px;
            animation: fadeIn 0.3s ease-in;
        }

        .message.user {
            align-self: flex-end;
            background-color: #4f46e5;
            color: white;
        }

        .message.assistant {
            align-self: flex-start;
            background-color: white;
            border: 1px solid #e5e7eb;
        }

        .message-meta {
            margin-top: 8px;
            font-size: 12px;
            opacity: 0.7;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .transcription-indicator {
            font-size: 11px;
            padding: 2px 6px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
        }

        /* Text Input Area */
        .text-input-area {
            padding: 16px 24px;
            background-color: white;
            border-top: 1px solid #e5e7eb;
        }

        .input-container {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .message-input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            outline: none;
            transition: border-color 0.2s;
        }

        .message-input:focus {
            border-color: #4f46e5;
        }

        /* Voice Chat Interface */
        .voice-chat-interface {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
            background-color: #f9fafb;
        }

        .voice-status-display {
            text-align: center;
            margin-bottom: 40px;
        }

        .voice-status-display h2 {
            font-size: 28px;
            margin-bottom: 8px;
            color: #111827;
        }

        .voice-status-display p {
            color: #6b7280;
        }

        .voice-visualizer {
            width: 300px;
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            margin-bottom: 40px;
        }

        .voice-bar {
            width: 6px;
            background-color: #4f46e5;
            border-radius: 3px;
            transition: height 0.1s ease;
        }

        .voice-controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .voice-record-btn {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
            position: relative;
        }

        .voice-record-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 25px rgba(102, 126, 234, 0.6);
        }

        .voice-record-btn.recording {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            animation: pulse 1.5s infinite;
        }

        .voice-record-btn.recording::after {
            content: '';
            position: absolute;
            top: -20px;
            left: -20px;
            right: -20px;
            bottom: -20px;
            border: 3px solid #f5576c;
            border-radius: 50%;
            animation: ripple 1.5s infinite;
        }

        .recording-time {
            font-size: 18px;
            font-weight: 600;
            color: #4f46e5;
        }

        .voice-hint {
            color: #6b7280;
            font-size: 14px;
        }

        /* Input Button */
        .input-btn {
            padding: 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 44px;
            height: 44px;
        }

        .send-btn {
            background-color: #4f46e5;
            color: white;
        }

        .send-btn:hover {
            background-color: #4338ca;
        }

        .send-btn:disabled {
            background-color: #e5e7eb;
            cursor: not-allowed;
        }

        /* Empty State */
        .empty-state {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #9ca3af;
        }

        .empty-state svg {
            width: 64px;
            height: 64px;
            margin-bottom: 16px;
            color: #e5e7eb;
        }

        /* Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 4px 20px rgba(245, 87, 108, 0.4);
            }
            50% {
                box-shadow: 0 4px 35px rgba(245, 87, 108, 0.8);
            }
            100% {
                box-shadow: 0 4px 20px rgba(245, 87, 108, 0.4);
            }
        }

        @keyframes ripple {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            100% {
                transform: scale(1.2);
                opacity: 0;
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Icons */
        .icon {
            width: 20px;
            height: 20px;
        }

        .icon-lg {
            width: 32px;
            height: 32px;
        }

        /* Profile Styles */
        .profile-container {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
            background-color: #f9fafb;
        }

        .profile-section {
            background: white;
            padding: 24px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 32px;
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 32px;
            font-weight: 600;
        }

        .profile-info h2 {
            font-size: 24px;
            margin-bottom: 4px;
        }

        .profile-info p {
            color: #6b7280;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .edit-btn {
            padding: 6px 12px;
            background-color: #f3f4f6;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            color: #4f46e5;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .edit-btn:hover {
            background-color: #e5e7eb;
        }

        .topics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 12px;
        }

        .topic-chip {
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
            position: relative;
            overflow: hidden;
        }

        .topic-chip:hover {
            border-color: #4f46e5;
            background-color: #f9fafb;
        }

        .topic-chip.selected {
            border-color: #4f46e5;
            background-color: #e0e7ff;
            color: #4f46e5;
            font-weight: 500;
        }

        .topic-chip.selected::after {
            content: '✓';
            position: absolute;
            top: 4px;
            right: 8px;
            font-size: 12px;
            color: #4f46e5;
        }

        .topic-icon {
            font-size: 24px;
            margin-bottom: 4px;
        }

        .interest-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-top: 20px;
        }

        .stat-card {
            padding: 16px;
            background-color: #f9fafb;
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 600;
            color: #4f46e5;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 14px;
            color: #6b7280;
        }

        .save-preferences-btn {
            width: 100%;
            padding: 12px;
            background-color: #4f46e5;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
            margin-top: 20px;
        }

        .save-preferences-btn:hover {
            background-color: #4338ca;
        }

        .preference-info {
            padding: 16px;
            background-color: #f0f9ff;
            border: 1px solid #bae6fd;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            color: #0369a1;
        }

        /* Typing Indicator */
        .typing-indicator {
            display: flex;
            gap: 4px;
            padding: 8px 12px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #6b7280;
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) {
            animation-delay: -0.32s;
        }

        .typing-dot:nth-child(2) {
            animation-delay: -0.16s;
        }

        @keyframes typing {
            0%, 80%, 100% {
                transform: scale(0.8);
                opacity: 0.5;
            }
            40% {
                transform: scale(1);
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="user-info">
                    <div class="user-avatar">U</div>
                    <div>
                        <p style="font-weight: 600;">AI Chatbot</p>
                        <p style="font-size: 12px; color: #6b7280;">Demo User</p>
                    </div>
                </div>
                <button class="new-chat-btn" onclick="showNewChatModal()">
                    <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                    </svg>
                    New Chat
                </button>
            </div>
            <div class="chat-list" id="chatList">
                <!-- Chat items will be dynamically added here -->
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content" id="mainContent">
            <div class="empty-state">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                </svg>
                <h3 style="color: #6b7280;">No Chat Selected</h3>
                <p style="color: #9ca3af;">Create a new chat to get started</p>
            </div>
        </div>
    </div>

    <!-- New Chat Modal -->
    <div id="newChatModal" class="modal-overlay" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h2>Create New Chat</h2>
                <p>Choose your preferred chat mode</p>
            </div>
            
            <div class="chat-mode-options">
                <div class="mode-option" onclick="selectChatMode('text')" id="textModeOption">
                    <div class="mode-icon">
                        <svg class="icon-lg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                        </svg>
                    </div>
                    <div class="mode-info">
                        <h3>Text Chat</h3>
                        <p>Type messages and receive text responses</p>
                    </div>
                </div>
                
                <div class="mode-option" onclick="selectChatMode('voice')" id="voiceModeOption">
                    <div class="mode-icon">
                        <svg class="icon-lg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path>
                        </svg>
                    </div>
                    <div class="mode-info">
                        <h3>Voice Chat</h3>
                        <p>Speak naturally and have voice conversations</p>
                    </div>
                </div>
            </div>
            
            <div class="modal-actions">
                <button class="modal-btn cancel" onclick="hideNewChatModal()">Cancel</button>
                <button class="modal-btn primary" id="createChatBtn" onclick="createNewChat()" disabled>Create Chat</button>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let activeChat = null;
        let chats = [];
        let messages = [];
        let selectedChatMode = null;
        let isRecording = false;
        let isAiTyping = false;
        let recordingStartTime = null;
        let recordingTimer = null;
        let audioContext = null;
        let analyser = null;
        let microphone = null;
        let animationId = null;
        let currentView = 'chats';
        let userTopics = [];
        let editingTopics = false;

        // Available topics for personalization
        const availableTopics = [
            { id: 'tech', name: 'Technology', icon: '💻' },
            { id: 'science', name: 'Science', icon: '🔬' },
            { id: 'health', name: 'Health & Fitness', icon: '🏃‍♂️' },
            { id: 'cooking', name: 'Cooking', icon: '🍳' },
            { id: 'travel', name: 'Travel', icon: '✈️' },
            { id: 'music', name: 'Music', icon: '🎵' },
            { id: 'art', name: 'Art & Design', icon: '🎨' },
            { id: 'sports', name: 'Sports', icon: '⚽' },
            { id: 'gaming', name: 'Gaming', icon: '🎮' },
            { id: 'books', name: 'Books & Literature', icon: '📚' },
            { id: 'movies', name: 'Movies & TV', icon: '🎬' },
            { id: 'business', name: 'Business', icon: '💼' },
            { id: 'finance', name: 'Finance', icon: '💰' },
            { id: 'history', name: 'History', icon: '📜' },
            { id: 'philosophy', name: 'Philosophy', icon: '🤔' },
            { id: 'nature', name: 'Nature', icon: '🌿' },
            { id: 'space', name: 'Space', icon: '🚀' },
            { id: 'fashion', name: 'Fashion', icon: '👗' },
            { id: 'cars', name: 'Cars', icon: '🚗' },
            { id: 'pets', name: 'Pets', icon: '🐕' }
        ];

        // Initialize demo data
        function initDemo() {
            // Load saved topics from localStorage
            const savedTopics = localStorage.getItem('userTopics');
            if (savedTopics) {
                userTopics = JSON.parse(savedTopics);
            } else {
                // Default topics for new users
                userTopics = ['tech', 'health', 'cooking'];
                localStorage.setItem('userTopics', JSON.stringify(userTopics));
            }

            // Add some demo chats
            chats = [
                {
                    id: 1,
                    title: 'Tech Discussion',
                    description: 'About latest technology',
                    mode: 'text',
                    relatedTopic: 'tech',
                    messages: [
                        { id: 1, content: 'Hello! I see you\'re interested in technology. What would you like to discuss?', sender_type: 'assistant', created_at: new Date(Date.now() - 3600000).toISOString() },
                        { id: 2, content: 'What\'s your take on AI development?', sender_type: 'user', created_at: new Date(Date.now() - 3000000).toISOString() },
                        { id: 3, content: 'AI development is fascinating! We\'re seeing rapid advances in natural language processing, computer vision, and machine learning. The key areas of growth include generative AI, edge computing, and ethical AI frameworks.', sender_type: 'assistant', created_at: new Date(Date.now() - 2940000).toISOString() }
                    ]
                },
                {
                    id: 2,
                    title: 'Healthy Recipes',
                    description: 'Voice chat about cooking',
                    mode: 'voice',
                    relatedTopic: 'cooking',
                    messages: [
                        { id: 4, content: 'Welcome! Based on your interests in cooking and health, I\'m here to help you discover healthy recipes. Feel free to ask me anything!', sender_type: 'assistant', created_at: new Date(Date.now() - 7200000).toISOString() },
                        { id: 5, content: 'Can you suggest a healthy breakfast?', sender_type: 'user', created_at: new Date(Date.now() - 7140000).toISOString(), isTranscription: true },
                        { id: 6, content: 'I\'d recommend a protein-rich breakfast bowl: Greek yogurt with berries, a handful of nuts, chia seeds, and a drizzle of honey. It\'s nutritious, filling, and takes just 5 minutes to prepare!', sender_type: 'assistant', created_at: new Date(Date.now() - 7080000).toISOString() }
                    ]
                }
            ];
            
            updateChatList();
        }

        // Switch between views
        function switchView(view) {
            currentView = view;
            
            // Update navigation
            document.getElementById('navChats').classList.toggle('active', view === 'chats');
            document.getElementById('navProfile').classList.toggle('active', view === 'profile');
            
            // Update sidebar content
            document.getElementById('chatList').style.display = view === 'chats' ? 'block' : 'none';
            
            // Update main content
            if (view === 'profile') {
                renderProfileView();
            } else {
                if (activeChat) {
                    updateUI();
                } else {
                    const mainContent = document.getElementById('mainContent');
                    mainContent.innerHTML = `
                        <div class="empty-state">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                            </svg>
                            <h3 style="color: #6b7280;">No Chat Selected</h3>
                            <p style="color: #9ca3af;">Choose a chat from the sidebar or create a new one</p>
                        </div>
                    `;
                }
            }
        }

        // Render profile view
        function renderProfileView() {
            const mainContent = document.getElementById('mainContent');
            mainContent.innerHTML = `
                <div class="profile-container">
                    <div class="profile-section">
                        <div class="profile-header">
                            <div class="profile-avatar">U</div>
                            <div class="profile-info">
                                <h2>Demo User</h2>
                                <p>user@example.com</p>
                            </div>
                        </div>
                    </div>

                    <div class="profile-section">
                        <div class="section-title">
                            <span>My Interest Topics</span>
                            <button class="edit-btn" onclick="toggleEditTopics()">
                                ${editingTopics ? 'Done' : 'Edit'}
                            </button>
                        </div>
                        
                        ${!editingTopics ? `
                            <div class="preference-info">
                                <strong>💡 Tip:</strong> Your selected topics help personalize your chat experience. The AI will tailor responses based on your interests.
                            </div>
                        ` : ''}
                        
                        <div class="topics-grid" id="topicsGrid">
                            ${availableTopics.map(topic => `
                                <div class="topic-chip ${userTopics.includes(topic.id) ? 'selected' : ''}" 
                                     onclick="toggleTopic('${topic.id}')"
                                     style="${!editingTopics && !userTopics.includes(topic.id) ? 'display: none;' : ''}">
                                    <div class="topic-icon">${topic.icon}</div>
                                    <div>${topic.name}</div>
                                </div>
                            `).join('')}
                        </div>
                        
                        ${editingTopics ? `
                            <button class="save-preferences-btn" onclick="saveTopics()">
                                Save Preferences
                            </button>
                        ` : ''}
                        
                        <div class="interest-stats">
                            <div class="stat-card">
                                <div class="stat-value">${userTopics.length}</div>
                                <div class="stat-label">Selected Topics</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">${getTopicChatsCount()}</div>
                                <div class="stat-label">Topic-based Chats</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">${getPersonalizedResponseRate()}%</div>
                                <div class="stat-label">Personalization Rate</div>
                            </div>
                        </div>
                    </div>

                    <div class="profile-section">
                        <div class="section-title">
                            <span>Recommended Topics</span>
                        </div>
                        <p style="color: #6b7280; margin-bottom: 16px;">
                            Based on your current interests, you might also enjoy:
                        </p>
                        <div class="topics-grid">
                            ${getRecommendedTopics().map(topic => `
                                <div class="topic-chip" onclick="addRecommendedTopic('${topic.id}')">
                                    <div class="topic-icon">${topic.icon}</div>
                                    <div>${topic.name}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        // Toggle edit mode for topics
        function toggleEditTopics() {
            editingTopics = !editingTopics;
            renderProfileView();
        }

        // Toggle topic selection
        function toggleTopic(topicId) {
            if (!editingTopics) return;
            
            const index = userTopics.indexOf(topicId);
            if (index > -1) {
                userTopics.splice(index, 1);
            } else {
                userTopics.push(topicId);
            }
            
            renderProfileView();
        }

        // Save topics
        function saveTopics() {
            localStorage.setItem('userTopics', JSON.stringify(userTopics));
            editingTopics = false;
            renderProfileView();
            
            // Show success message
            const mainContent = document.getElementById('mainContent');
            const successMsg = document.createElement('div');
            successMsg.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #10b981;
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.1);
                animation: slideIn 0.3s ease-out;
            `;
            successMsg.textContent = 'Preferences saved successfully!';
            document.body.appendChild(successMsg);
            
            setTimeout(() => {
                successMsg.remove();
            }, 3000);
        }

        // Get topic-based chats count
        function getTopicChatsCount() {
            return chats.filter(chat => chat.relatedTopic && userTopics.includes(chat.relatedTopic)).length;
        }

        // Get personalized response rate (demo)
        function getPersonalizedResponseRate() {
            return Math.floor(75 + Math.random() * 20); // Demo: 75-95%
        }

        // Get recommended topics
        function getRecommendedTopics() {
            const recommendations = {
                'tech': ['science', 'gaming', 'business'],
                'health': ['cooking', 'sports', 'nature'],
                'cooking': ['health', 'travel', 'art'],
                'science': ['tech', 'space', 'philosophy'],
                'travel': ['cooking', 'history', 'nature']
            };
            
            let recommended = new Set();
            userTopics.forEach(topic => {
                if (recommendations[topic]) {
                    recommendations[topic].forEach(rec => {
                        if (!userTopics.includes(rec)) {
                            recommended.add(rec);
                        }
                    });
                }
            });
            
            return Array.from(recommended).slice(0, 3).map(id => 
                availableTopics.find(topic => topic.id === id)
            ).filter(Boolean);
        }

        // Add recommended topic
        function addRecommendedTopic(topicId) {
            if (!userTopics.includes(topicId)) {
                userTopics.push(topicId);
                localStorage.setItem('userTopics', JSON.stringify(userTopics));
                renderProfileView();
            }
        }

        // Show new chat modal
        function showNewChatModal() {
            document.getElementById('newChatModal').style.display = 'flex';
            selectedChatMode = null;
            updateCreateButton();
        }

        // Hide new chat modal
        function hideNewChatModal() {
            document.getElementById('newChatModal').style.display = 'none';
            selectedChatMode = null;
            // Reset selection
            document.getElementById('textModeOption').classList.remove('selected');
            document.getElementById('voiceModeOption').classList.remove('selected');
        }

        // Select chat mode
        function selectChatMode(mode) {
            selectedChatMode = mode;
            
            // Update UI
            document.getElementById('textModeOption').classList.remove('selected');
            document.getElementById('voiceModeOption').classList.remove('selected');
            
            if (mode === 'text') {
                document.getElementById('textModeOption').classList.add('selected');
            } else {
                document.getElementById('voiceModeOption').classList.add('selected');
            }
            
            updateCreateButton();
        }

        // Update create button state
        function updateCreateButton() {
            const btn = document.getElementById('createChatBtn');
            btn.disabled = !selectedChatMode;
        }

        // Create new chat
        function createNewChat() {
            if (!selectedChatMode) return;
            
            // Check if user has topics selected
            const suggestedTopic = userTopics.length > 0 ? 
                availableTopics.find(t => userTopics.includes(t.id)) : null;
            
            const newChat = {
                id: Date.now(),
                title: `${selectedChatMode === 'text' ? 'Text' : 'Voice'} Chat ${chats.length + 1}`,
                description: `New ${selectedChatMode} conversation`,
                mode: selectedChatMode,
                relatedTopic: suggestedTopic ? suggestedTopic.id : null,
                messages: []
            };
            
            chats.unshift(newChat);
            updateChatList();
            selectChat(newChat);
            hideNewChatModal();
            
            // Add personalized welcome message
            setTimeout(() => {
                let welcomeContent = selectedChatMode === 'text' 
                    ? 'Hello! Type your message below to start our conversation.' 
                    : 'Welcome to voice chat! Press and hold the microphone button to speak.';
                
                if (suggestedTopic && userTopics.length > 0) {
                    const topicNames = userTopics.map(id => 
                        availableTopics.find(t => t.id === id)?.name
                    ).filter(Boolean).join(', ');
                    
                    welcomeContent = `Hello! I see you're interested in ${topicNames}. ${welcomeContent} Feel free to ask me anything related to your interests!`;
                }
                
                const welcomeMessage = {
                    id: Date.now(),
                    content: welcomeContent,
                    sender_type: 'assistant',
                    created_at: new Date().toISOString()
                };
                messages.push(welcomeMessage);
                newChat.messages.push(welcomeMessage);
                updateMessagesArea();
            }, 500);
        }

        // Select a chat
        function selectChat(chat) {
            activeChat = chat;
            messages = chat.messages || [];
            updateUI();
        }

        // Update UI based on active chat
        function updateUI() {
            updateChatList();
            
            const mainContent = document.getElementById('mainContent');
            
            if (!activeChat) {
                mainContent.innerHTML = `
                    <div class="empty-state">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                        </svg>
                        <h3 style="color: #6b7280;">No Chat Selected</h3>
                        <p style="color: #9ca3af;">Create a new chat to get started</p>
                    </div>
                `;
                return;
            }
            
            if (activeChat.mode === 'text') {
                renderTextChat();
            } else {
                renderVoiceChat();
            }
        }

        // Render text chat interface
        function renderTextChat() {
            const mainContent = document.getElementById('mainContent');
            mainContent.innerHTML = `
                <div class="chat-header">
                    <div>
                        <h3 style="font-size: 18px; font-weight: 600;">${activeChat.title}</h3>
                        <p style="font-size: 14px; color: #6b7280;">${activeChat.description}</p>
                    </div>
                    <div class="header-controls">
                        <div class="status-indicator">
                            <div class="status-dot"></div>
                            <span>Demo Mode</span>
                        </div>
                    </div>
                </div>
                
                <div class="messages-area" id="messagesArea">
                    <!-- Messages will be rendered here -->
                </div>
                
                <div class="text-input-area">
                    <form class="input-container" onsubmit="sendTextMessage(event)">
                        <input 
                            type="text" 
                            id="messageInput" 
                            class="message-input" 
                            placeholder="Type your message..."
                            autocomplete="off"
                        />
                        <button type="submit" class="input-btn send-btn">
                            <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                            </svg>
                        </button>
                    </form>
                </div>
            `;
            
            updateMessagesArea();
        }

        // Render voice chat interface
        function renderVoiceChat() {
            const mainContent = document.getElementById('mainContent');
            mainContent.innerHTML = `
                <div class="chat-header">
                    <div>
                        <h3 style="font-size: 18px; font-weight: 600;">${activeChat.title}</h3>
                        <p style="font-size: 14px; color: #6b7280;">${activeChat.description}</p>
                    </div>
                    <div class="header-controls">
                        <div class="status-indicator">
                            <div class="status-dot"></div>
                            <span>Demo Mode</span>
                        </div>
                    </div>
                </div>
                
                <div class="messages-area" id="messagesArea" style="max-height: 50vh;">
                    <!-- Messages will be rendered here -->
                </div>
                
                <div class="voice-chat-interface">
                    <div class="voice-status-display">
                        <h2 id="voiceStatus">Ready to Listen</h2>
                        <p id="voiceSubStatus">Press and hold the button to speak</p>
                    </div>
                    
                    <div class="voice-visualizer" id="voiceVisualizer">
                        <!-- Voice bars will be dynamically created -->
                    </div>
                    
                    <div class="voice-controls">
                        <button 
                            class="voice-record-btn" 
                            id="voiceRecordBtn"
                            onmousedown="startVoiceRecording()"
                            onmouseup="stopVoiceRecording()"
                            onmouseleave="stopVoiceRecording()"
                            ontouchstart="startVoiceRecording()"
                            ontouchend="stopVoiceRecording()"
                        >
                            <svg class="icon-lg" style="width: 48px; height: 48px;" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
                                <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
                            </svg>
                        </button>
                        <div class="recording-time" id="recordingTime" style="display: none;">0:00</div>
                        <p class="voice-hint" id="voiceHint">Hold to record</p>
                    </div>
                </div>
            `;
            
            // Create voice visualizer bars
            const visualizer = document.getElementById('voiceVisualizer');
            for (let i = 0; i < 20; i++) {
                const bar = document.createElement('div');
                bar.className = 'voice-bar';
                bar.style.height = '20px';
                visualizer.appendChild(bar);
            }
            
            updateMessagesArea();
        }

        // Update chat list
        function updateChatList() {
            const chatList = document.getElementById('chatList');
            chatList.innerHTML = '';
            
            chats.forEach(chat => {
                const chatItem = document.createElement('div');
                chatItem.className = `chat-item ${activeChat?.id === chat.id ? 'active' : ''}`;
                chatItem.innerHTML = `
                    <div>
                        <div style="font-weight: 500;">${chat.title}</div>
                        <div style="font-size: 12px; color: #9ca3af; margin-top: 4px;">${chat.description}</div>
                    </div>
                    <span class="chat-mode-badge">${chat.mode.toUpperCase()}</span>
                `;
                chatItem.onclick = () => selectChat(chat);
                chatList.appendChild(chatItem);
            });
        }

        // Update messages area
        function updateMessagesArea() {
            const messagesArea = document.getElementById('messagesArea');
            if (!messagesArea) return;
            
            messagesArea.innerHTML = '';
            
            messages.forEach(message => {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${message.sender_type}`;
                
                let metaInfo = formatTime(message.created_at);
                if (message.isTranscription) {
                    metaInfo += ' <span class="transcription-indicator">Transcribed</span>';
                }
                
                messageDiv.innerHTML = `
                    <div>${message.content}</div>
                    <div class="message-meta">${metaInfo}</div>
                `;
                
                messagesArea.appendChild(messageDiv);
            });
            
            // Add typing indicator if AI is typing
            if (isAiTyping) {
                const typingDiv = document.createElement('div');
                typingDiv.className = 'message assistant';
                typingDiv.innerHTML = `
                    <div class="typing-indicator">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                `;
                messagesArea.appendChild(typingDiv);
            }
            
            // Scroll to bottom
            messagesArea.scrollTop = messagesArea.scrollHeight;
        }

        // Send text message
        function sendTextMessage(event) {
            event.preventDefault();
            
            const input = document.getElementById('messageInput');
            const content = input.value.trim();
            
            if (!content) return;
            
            // Add user message
            const userMessage = {
                id: Date.now(),
                content: content,
                sender_type: 'user',
                created_at: new Date().toISOString()
            };
            
            messages.push(userMessage);
            activeChat.messages.push(userMessage);
            updateMessagesArea();
            
            input.value = '';
            
            // Simulate AI typing
            isAiTyping = true;
            updateMessagesArea();
            
            // Simulate AI response after delay
            setTimeout(() => {
                isAiTyping = false;
                
                const aiMessage = {
                    id: Date.now() + 1,
                    content: getAIResponse(content),
                    sender_type: 'assistant',
                    created_at: new Date().toISOString()
                };
                
                messages.push(aiMessage);
                activeChat.messages.push(aiMessage);
                updateMessagesArea();
            }, 1500 + Math.random() * 1000);
        }

        // Start voice recording
        async function startVoiceRecording() {
            if (isRecording) return;
            
            try {
                // Request microphone permission
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                
                // Set up audio context for visualization
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                analyser = audioContext.createAnalyser();
                microphone = audioContext.createMediaStreamSource(stream);
                microphone.connect(analyser);
                analyser.fftSize = 256;
                
                isRecording = true;
                recordingStartTime = Date.now();
                
                // Update UI
                document.getElementById('voiceRecordBtn').classList.add('recording');
                document.getElementById('voiceStatus').textContent = 'Listening...';
                document.getElementById('voiceSubStatus').textContent = 'Speak clearly into your microphone';
                document.getElementById('recordingTime').style.display = 'block';
                document.getElementById('voiceHint').style.display = 'none';
                
                // Start timer
                recordingTimer = setInterval(updateRecordingTime, 100);
                
                // Start visualization
                visualizeAudio();
                
            } catch (error) {
                console.error('Microphone access denied:', error);
                alert('Please allow microphone access to use voice chat');
            }
        }

        // Stop voice recording
        function stopVoiceRecording() {
            if (!isRecording) return;
            
            isRecording = false;
            clearInterval(recordingTimer);
            
            // Stop audio context
            if (microphone) {
                microphone.disconnect();
                microphone = null;
            }
            if (audioContext) {
                audioContext.close();
                audioContext = null;
            }
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }
            
            // Update UI
            document.getElementById('voiceRecordBtn').classList.remove('recording');
            document.getElementById('voiceStatus').textContent = 'Processing...';
            document.getElementById('voiceSubStatus').textContent = 'Converting speech to text';
            document.getElementById('recordingTime').style.display = 'none';
            
            // Reset visualizer
            const bars = document.querySelectorAll('.voice-bar');
            bars.forEach(bar => bar.style.height = '20px');
            
            // Simulate transcription
            setTimeout(() => {
                const duration = Date.now() - recordingStartTime;
                const transcription = getSimulatedTranscription(duration);
                
                if (transcription) {
                    // Add user message (transcribed)
                    const userMessage = {
                        id: Date.now(),
                        content: transcription,
                        sender_type: 'user',
                        created_at: new Date().toISOString(),
                        isTranscription: true
                    };
                    
                    messages.push(userMessage);
                    activeChat.messages.push(userMessage);
                    updateMessagesArea();
                    
                    // Reset status
                    document.getElementById('voiceStatus').textContent = 'Transcription Complete';
                    document.getElementById('voiceSubStatus').textContent = 'AI is thinking...';
                    
                    // Simulate AI response
                    isAiTyping = true;
                    updateMessagesArea();
                    
                    setTimeout(() => {
                        isAiTyping = false;
                        
                        const aiMessage = {
                            id: Date.now() + 1,
                            content: getAIResponse(transcription),
                            sender_type: 'assistant',
                            created_at: new Date().toISOString()
                        };
                        
                        messages.push(aiMessage);
                        activeChat.messages.push(aiMessage);
                        updateMessagesArea();
                        
                        // Reset UI
                        document.getElementById('voiceStatus').textContent = 'Ready to Listen';
                        document.getElementById('voiceSubStatus').textContent = 'Press and hold the button to speak';
                        document.getElementById('voiceHint').style.display = 'block';
                    }, 2000);
                } else {
                    // No transcription
                    document.getElementById('voiceStatus').textContent = 'No Speech Detected';
                    document.getElementById('voiceSubStatus').textContent = 'Please try again';
                    document.getElementById('voiceHint').style.display = 'block';
                    
                    setTimeout(() => {
                        document.getElementById('voiceStatus').textContent = 'Ready to Listen';
                        document.getElementById('voiceSubStatus').textContent = 'Press and hold the button to speak';
                    }, 2000);
                }
            }, 1000);
        }

        // Visualize audio
        function visualizeAudio() {
            if (!isRecording || !analyser) return;
            
            const bufferLength = analyser.frequencyBinCount;
            const dataArray = new Uint8Array(bufferLength);
            analyser.getByteFrequencyData(dataArray);
            
            const bars = document.querySelectorAll('.voice-bar');
            const barCount = bars.length;
            const step = Math.floor(bufferLength / barCount);
            
            for (let i = 0; i < barCount; i++) {
                const value = dataArray[i * step];
                const height = Math.max(10, (value / 255) * 80);
                bars[i].style.height = `${height}px`;
            }
            
            animationId = requestAnimationFrame(visualizeAudio);
        }

        // Update recording time
        function updateRecordingTime() {
            const elapsed = Date.now() - recordingStartTime;
            const seconds = Math.floor(elapsed / 1000);
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            document.getElementById('recordingTime').textContent = 
                `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
        }

        // Get simulated transcription based on recording duration
        function getSimulatedTranscription(duration) {
            if (duration < 500) return null;
            
            const transcriptions = [
                "What's the weather like today?",
                "Tell me a joke",
                "How does machine learning work?",
                "What are the benefits of meditation?",
                "Can you help me with a recipe?",
                "What's the latest news?",
                "How do I improve my productivity?",
                "Explain quantum computing",
                "What are some good books to read?",
                "How can I learn a new language?"
            ];
            
            return transcriptions[Math.floor(Math.random() * transcriptions.length)];
        }

        // Get AI response
        function getAIResponse(input) {
            const responses = {
                'weather': "In demo mode, I can't fetch real weather data, but I'd normally provide you with current conditions, temperature, and forecast for your location.",
                'joke': "Why don't scientists trust atoms? Because they make up everything! 😄",
                'machine learning': "Machine learning is a subset of AI that enables systems to learn and improve from experience without being explicitly programmed. It uses algorithms to analyze data, identify patterns, and make decisions.",
                'meditation': "Meditation offers numerous benefits including reduced stress, improved focus, better emotional regulation, and enhanced self-awareness. Even just 10 minutes daily can make a difference!",
                'recipe': "I'd be happy to help with recipes! What type of cuisine are you interested in, or do you have specific ingredients you'd like to use?",
                'news': "In a live system, I would fetch the latest news for you. For now, I recommend checking reputable news sources for current events.",
                'productivity': "Some key productivity tips include: time-blocking your calendar, using the Pomodoro Technique, minimizing distractions, and prioritizing tasks with methods like the Eisenhower Matrix.",
                'quantum': "Quantum computing uses quantum bits (qubits) that can exist in multiple states simultaneously, unlike classical bits. This allows quantum computers to solve certain complex problems exponentially faster.",
                'books': "Some great books to consider: 'Sapiens' by Yuval Noah Harari, 'Atomic Habits' by James Clear, or 'The Midnight Library' by Matt Haig. What genres interest you?",
                'language': "Learning a new language is rewarding! Start with apps like Duolingo, practice daily, immerse yourself in media in that language, and find conversation partners for practice."
            };
            
            // Add personalized responses based on user topics
            const personalizedResponses = {
                'tech': "Since you're interested in technology, you might enjoy learning about the latest developments in AI, quantum computing, or blockchain. What specific tech area excites you most?",
                'health': "Given your interest in health and fitness, I can share tips on nutrition, exercise routines, or mental wellness. What aspect of health would you like to explore?",
                'cooking': "As someone interested in cooking, I'd love to share recipes, cooking techniques, or food pairing suggestions. Are you looking for something specific?",
                'science': "Your interest in science opens up fascinating topics! We could discuss recent discoveries, scientific methods, or explore specific fields like physics, chemistry, or biology.",
                'travel': "Travel enthusiasts like you might enjoy discussing destination recommendations, travel tips, or cultural experiences. Where are you thinking of going next?"
            };
            
            const inputLower = input.toLowerCase();
            
            // Check for topic-specific keywords
            for (const [key, response] of Object.entries(responses)) {
                if (inputLower.includes(key)) {
                    // Add personalized touch if user has related interests
                    const relatedTopic = userTopics.find(topic => 
                        inputLower.includes(topic) || key.includes(topic)
                    );
                    
                    if (relatedTopic && personalizedResponses[relatedTopic]) {
                        return response + " " + personalizedResponses[relatedTopic];
                    }
                    return response;
                }
            }
            
            // Check if input relates to user's interests
            for (const topic of userTopics) {
                if (inputLower.includes(topic) && personalizedResponses[topic]) {
                    return personalizedResponses[topic];
                }
            }
            
            // Default response with personalization hint
            let defaultResponse = "That's an interesting question! In this demo, I'm providing simulated responses. In a real implementation, I would give you a thoughtful, detailed answer based on the latest information available.";
            
            if (userTopics.length > 0) {
                const topicNames = userTopics.map(id => 
                    availableTopics.find(t => t.id === id)?.name
                ).filter(Boolean).join(', ');
                defaultResponse += ` Since you're interested in ${topicNames}, feel free to ask me anything related to those topics!`;
            }
            
            return defaultResponse;
        }

        // Format time
        function formatTime(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diff = now - date;
            
            if (diff < 60000) {
                return 'Just now';
            } else if (diff < 3600000) {
                return `${Math.floor(diff / 60000)}m ago`;
            } else if (diff < 86400000) {
                return `${Math.floor(diff / 3600000)}h ago`;
            } else {
                return date.toLocaleString();
            }
        }

        // Initialize demo on load
        document.addEventListener('DOMContentLoaded', initDemo);
    </script>
</body>
</html>